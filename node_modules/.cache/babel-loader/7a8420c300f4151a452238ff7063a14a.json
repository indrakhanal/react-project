{"ast":null,"code":"import _objectSpread from\"C:/Users/S.K. COMPUTER/OneDrive/Desktop/react-project/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/S.K. COMPUTER/OneDrive/Desktop/react-project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/S.K. COMPUTER/OneDrive/Desktop/react-project/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\S.K. COMPUTER\\\\OneDrive\\\\Desktop\\\\react-project\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import{DeleteIcon}from\"assets/images/xd\";import NepaliDatePicker from\"components/React/Datepicker/Datepicker\";import EnglishDatePicker from\"components/React/EnglishDatepicker/EnglishDatepicker\";import FormikValidationError,{FormikFieldArrayValidationError}from\"components/React/FormikValidationError/FormikValidationError\";import toast from\"components/React/ToastNotifier/ToastNotifier\";import Button from\"components/UI/Forms/Buttons\";import TooltipLabel from\"components/UI/TooltipLabel\";import{FieldArray,Form,Formik}from\"formik\";import React from\"react\";import{useTranslation}from\"react-i18next\";import{connect}from\"react-redux\";import{getUsIncomeEstimateThisYearAction}from\"store/modules/waterTarrifs/getIncomeEstimateThisYear\";import{getUseBasedWaterTarrifsAction}from\"store/modules/waterTarrifs/getUseBasedWaterTarrifs\";import{postUseBasedWaterTariffAction}from\"store/modules/waterTarrifs/postUseBasedWaterTariff\";import{updateUseBasedWaterTariffAction}from\"store/modules/waterTarrifs/updateUseBasedWaterTariff\";import formatDate from\"utils/utilsFunction/date-converter\";import*as Yup from\"yup\";var validationSchema=Yup.object({apply_date:Yup.mixed().required(\"This field is required\"),used_based_units:Yup.array().of(Yup.object().shape({unit_from:Yup.string().required(\"This field is required\"),unit_to:Yup.string().required(\"This field is required\"),rate:Yup.string().required(\"This field is required\"),estimated_paying_connection:Yup.string().required(\"This field is required\")}))});var UseBasedForm=function UseBasedForm(props){var _useTranslation=useTranslation(),t=_useTranslation.t;var editData=props.editData,postUseBasedWaterTariffAction=props.postUseBasedWaterTariffAction;console.log(editData,\"editDataeditData\");var _React$useState=React.useState({apply_date:\"\",used_based_units:[{unit_from:\"\",unit_to:\"\",rate:\"\",estimated_paying_connection:\"\"}]}),_React$useState2=_slicedToArray(_React$useState,2),initialData=_React$useState2[0],setInitialData=_React$useState2[1];React.useEffect(function(){if(props.scheme){var _props$scheme;setInitialData({apply_date:((_props$scheme=props.scheme)===null||_props$scheme===void 0?void 0:_props$scheme.tool_start_date)||\"\",used_based_units:[{unit_from:\"\",unit_to:\"\",rate:\"\",estimated_paying_connection:\"\"}]});}},[props.scheme]);var handleTariffSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values,resetForm){var response,_props$editData,_props$editData$tarif,_props$editData$tarif2,updateValues,errorList;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!props.editData){_context.next=8;break;}updateValues=_objectSpread(_objectSpread({apply_date:values.apply_date},values.used_based_units[0]),{},{tariff:(_props$editData=props.editData)===null||_props$editData===void 0?void 0:(_props$editData$tarif=_props$editData.tariff)===null||_props$editData$tarif===void 0?void 0:_props$editData$tarif.tariff});console.log(updateValues,\"updateValues\");_context.next=5;return props.updateUseBasedWaterTariffAction(props.language,(_props$editData$tarif2=props.editData.tariff)===null||_props$editData$tarif2===void 0?void 0:_props$editData$tarif2.id,updateValues);case 5:response=_context.sent;_context.next=11;break;case 8:_context.next=10;return props.postUseBasedWaterTariffAction(props.language,_objectSpread(_objectSpread({},values),{},{apply_date:formatDate(values.apply_date)}));case 10:response=_context.sent;case 11:if(response&&(response.status===201||response.status===200)){if(response.status===201){resetForm();toast.success(t(\"home:postSuccess\"));}else{setInitialData({apply_date:\"\",used_based_units:[{unit_from:\"\",unit_to:\"\",rate:\"\",estimated_paying_connection:\"\"}]});toast.success(t(\"home:updateSuccess\"));}props.getUseBasedWaterTarrifsAction(props.language,props.schemeSlug);props.getUsIncomeEstimateThisYearAction(props.schemeSlug);}else{errorList=response.data&&response.data.error;if(errorList instanceof Array){errorList.forEach(function(item){toast.error(item);});}console.log(response,\"errrr\");}case 12:case\"end\":return _context.stop();}}},_callee);}));return function handleTariffSubmit(_x,_x2){return _ref.apply(this,arguments);};}();React.useEffect(function(){if(props.editData){var _props$editData2,_props$editData2$item,_props$editData3,_props$editData3$tari,_props$editData4,_props$editData4$tari,_props$editData5,_props$editData5$tari,_props$editData6,_props$editData6$tari;setInitialData({apply_date:(_props$editData2=props.editData)===null||_props$editData2===void 0?void 0:(_props$editData2$item=_props$editData2.item)===null||_props$editData2$item===void 0?void 0:_props$editData2$item.apply_date,used_based_units:[{unit_from:(_props$editData3=props.editData)===null||_props$editData3===void 0?void 0:(_props$editData3$tari=_props$editData3.tariff)===null||_props$editData3$tari===void 0?void 0:_props$editData3$tari.unit_from,unit_to:(_props$editData4=props.editData)===null||_props$editData4===void 0?void 0:(_props$editData4$tari=_props$editData4.tariff)===null||_props$editData4$tari===void 0?void 0:_props$editData4$tari.unit_to,rate:(_props$editData5=props.editData)===null||_props$editData5===void 0?void 0:(_props$editData5$tari=_props$editData5.tariff)===null||_props$editData5$tari===void 0?void 0:_props$editData5$tari.rate,estimated_paying_connection:(_props$editData6=props.editData)===null||_props$editData6===void 0?void 0:(_props$editData6$tari=_props$editData6.tariff)===null||_props$editData6$tari===void 0?void 0:_props$editData6$tari.estimated_paying_connection}]});}},[props.editData]);return/*#__PURE__*/React.createElement(Formik,{enableReinitialize:true,initialValues:initialData,validationSchema:validationSchema,onSubmit:function onSubmit(values,_ref2){var resetForm=_ref2.resetForm;handleTariffSubmit(values,resetForm);}},function(_ref3){var _props$scheme2;var values=_ref3.values,errors=_ref3.errors,touched=_ref3.touched,handleChange=_ref3.handleChange,setFieldValue=_ref3.setFieldValue;return/*#__PURE__*/React.createElement(Form,null,/*#__PURE__*/React.createElement(\"div\",{className:\"row tarrif_form \"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-4 \"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group top  mt-2\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1 pl-0 \"},t(\"home:applyDate\"),\" \",/*#__PURE__*/React.createElement(TooltipLabel,{id:\"apd\",text:\"The date from which this record  should be applied to the system.\"}),\":\"),((_props$scheme2=props.scheme)===null||_props$scheme2===void 0?void 0:_props$scheme2.system_date_format)===\"nep\"?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(NepaliDatePicker,{value:values.apply_date,name:\"apply_date\",onChange:function onChange(e){setFieldValue(\"apply_date\",e);}})):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(EnglishDatePicker,{name:\"apply_date\",value:values.apply_date,handleChange:function handleChange(e){setFieldValue(\"apply_date\",formatDate(e));}})),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"apply_date\",errors:errors,touched:touched}))),/*#__PURE__*/React.createElement(FieldArray,{name:\"used_based_units\",render:function render(arrayHelpers){return/*#__PURE__*/React.createElement(React.Fragment,null,values.used_based_units&&values.used_based_units.map(function(data,index){var _props$scheme3,_values$used_based_un;return/*#__PURE__*/React.createElement(\"div\",{className:\"col-12\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row align-items-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-2\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1 pl-0 \"},t(\"home:units\"),\":\"),/*#__PURE__*/React.createElement(\"input\",{type:\"number\",className:\"form-control\",name:\"used_based_units[\".concat(index,\"][unit_from]\"),value:values.used_based_units[index][\"unit_from\"],onChange:function onChange(e){setFieldValue(e.target.name,e.target.value);}}),/*#__PURE__*/React.createElement(FormikFieldArrayValidationError,{keyName:\"used_based_units\",name:\"unit_from\",index:index,errors:errors,touched:touched}))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-2\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1 pl-0 \"},t(\"finance:to\"),\":\"),/*#__PURE__*/React.createElement(\"input\",{type:\"number\",className:\"form-control\",name:\"used_based_units[\".concat(index,\"][unit_to]\"),value:values.used_based_units[index][\"unit_to\"],onChange:function onChange(e){setFieldValue(e.target.name,e.target.value);}}),/*#__PURE__*/React.createElement(FormikFieldArrayValidationError,{keyName:\"used_based_units\",name:\"unit_to\",index:index,errors:errors,touched:touched}))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-3\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1 pl-0 \"},t(\"home:rate\"),\" (\",(_props$scheme3=props.scheme)===null||_props$scheme3===void 0?void 0:_props$scheme3.currency,\"):\"),/*#__PURE__*/React.createElement(\"input\",{type:\"number\",className:\"form-control\",name:\"used_based_units[\".concat(index,\"][rate]\"),value:values.used_based_units[index][\"rate\"],onChange:function onChange(e){setFieldValue(e.target.name,e.target.value);}}),/*#__PURE__*/React.createElement(FormikFieldArrayValidationError,{keyName:\"used_based_units\",name:\"rate\",index:index,errors:errors,touched:touched}))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1 pl-0 \"},t(\"finance:epcs\"),\":\"),/*#__PURE__*/React.createElement(\"input\",{type:\"number\",className:\"form-control\",name:\"used_based_units[\".concat(index,\"][estimated_paying_connection]\"),value:values.used_based_units[index][\"estimated_paying_connection\"],onChange:function onChange(e){setFieldValue(e.target.name,e.target.value);}}),/*#__PURE__*/React.createElement(FormikFieldArrayValidationError,{keyName:\"used_based_units\",name:\"estimated_paying_connection\",index:index,errors:errors,touched:touched}))),!props.editData&&/*#__PURE__*/React.createElement(\"div\",{className:\"col-1 text-right\"},/*#__PURE__*/React.createElement(\"img\",{src:DeleteIcon,className:\"mb-3\",role:\"button\",onClick:function onClick(){return arrayHelpers.remove(index);}}))),index===((_values$used_based_un=values.used_based_units)===null||_values$used_based_un===void 0?void 0:_values$used_based_un.length)-1&&/*#__PURE__*/React.createElement(\"div\",{className:\"col-12 mt-3\"},/*#__PURE__*/React.createElement(\"div\",{className:\"text-right\"},!props.editData&&/*#__PURE__*/React.createElement(Button,{className:\"btn custom-btn  mr-3\",text:t(\"finance:add\"),onClick:function onClick(){return arrayHelpers.push(\"\");}}),/*#__PURE__*/React.createElement(Button,{className:\"btn custom-btn \",text:t(\"home:save\"),disabled:props.postLoading||props.updateLoading,loading:props.postLoading||props.updateLoading}))));}));}})));});};var mapStateToProps=function mapStateToProps(state){var _state$waterSchemeDat;return{language:state.i18nextData.languageType,scheme:state.waterSchemeData.waterSchemeDetailsData.data,schemeSlug:(_state$waterSchemeDat=state.waterSchemeData.waterSchemeDetailsData.data)===null||_state$waterSchemeDat===void 0?void 0:_state$waterSchemeDat.slug,supplySchedule:state.waterTarrifsData.waterTarrifData.data,postLoading:state.waterTarrifsData.postUseBasedWaterTariff.isFetching,updateLoading:state.waterTarrifsData.updateUseBasedWaterTariff.isFetching};};var mapDispatchToProps={postUseBasedWaterTariffAction:postUseBasedWaterTariffAction,updateUseBasedWaterTariffAction:updateUseBasedWaterTariffAction,getUsIncomeEstimateThisYearAction:getUsIncomeEstimateThisYearAction,getUseBasedWaterTarrifsAction:getUseBasedWaterTarrifsAction};var connector=connect(mapStateToProps,mapDispatchToProps);export default connector(UseBasedForm);","map":null,"metadata":{},"sourceType":"module"}