{"ast":null,"code":"import _objectSpread from\"C:/Users/S.K. COMPUTER/OneDrive/Desktop/react-project/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/S.K. COMPUTER/OneDrive/Desktop/react-project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/S.K. COMPUTER/OneDrive/Desktop/react-project/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\S.K. COMPUTER\\\\OneDrive\\\\Desktop\\\\react-project\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import NepaliDatePicker from\"components/React/Datepicker/Datepicker\";import EnglishDatePicker from\"components/React/EnglishDatepicker/EnglishDatepicker\";import FormikValidationError from\"components/React/FormikValidationError/FormikValidationError\";import StyledSelect from\"components/React/StyledSelect/StyledSelect\";import toast from\"components/React/ToastNotifier/ToastNotifier\";import CustomCheckBox from\"components/UI/CustomCheckbox\";import Button from\"components/UI/Forms/Buttons\";import{useFormik}from\"formik\";import React from\"react\";import{useTranslation}from\"react-i18next\";import{connect}from\"react-redux\";import{getComponentInfoAction}from\"store/modules/componentInfo/getComponentInfo\";import{getComponentLogsAction}from\"store/modules/componentLogs/getComponentLogs\";import{postComponentLogsAction}from\"store/modules/componentLogs/postComponentLogs\";import{updateComponentLogsAction}from\"store/modules/componentLogs/updateComponentLogs\";import{getDashboardComponentInfoAction}from\"store/modules/maintainance/dashboardComponentInfo\";import{getSupplyBeltsAction}from\"store/modules/supplyBelts/getWaterSupplyBelts\";import formatDate from\"utils/utilsFunction/date-converter\";import*as Yup from\"yup\";var LOG_TYPE_OPTIONS=[{label:\"Maintenance\",value:\"Maintenance\"},{label:\"Issue\",value:\"Issue\"}];var validationSchema=Yup.object({component:Yup.mixed().nullable().required(\"This field is required\"),log_type:Yup.mixed().nullable().required(\"This field is required\"),maintenance_date:Yup.string().required(\"This field is required\"),possible_failure:Yup.string().required(\"This field is required\"),maintenance_action:Yup.string().required(\"This field is required\"),duration:Yup.string().required(\"This field is required\"),cost_total:Yup.string().required(\"This field is required\"),labour_cost:Yup.string().required(\"This field is required\"),material_cost:Yup.string().required(\"This field is required\"),replacement_cost:Yup.string().required(\"This field is required\"),remarks:Yup.string().required(\"This field is required\").nullable()});var ComponentLists=function ComponentLists(props){var _props$scheme2;var _useTranslation=useTranslation(),t=_useTranslation.t;var _React$useState=React.useState({component:null,log_type:null,maintenance_date:\"\",possible_failure:\"\",maintenance_action:\"\",duration:\"\",cost_total:0,labour_cost:0,material_cost:0,replacement_cost:0,remarks:\"\",is_cost_seggregated:false}),_React$useState2=_slicedToArray(_React$useState,2),initialData=_React$useState2[0],setInitialData=_React$useState2[1];var _useFormik=useFormik({enableReinitialize:true,initialValues:initialData,validationSchema:validationSchema,onSubmit:function(){var _onSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values,_ref){var _values$component;var resetForm,response,requestData,_Object$values,_errors;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:resetForm=_ref.resetForm;requestData=_objectSpread(_objectSpread({},values),{},{component:(_values$component=values.component)===null||_values$component===void 0?void 0:_values$component.value,cost_total:values!==null&&values!==void 0&&values.is_cost_seggregated?Number(values===null||values===void 0?void 0:values.material_cost)+Number(values===null||values===void 0?void 0:values.replacement_cost)+Number(values===null||values===void 0?void 0:values.labour_cost):values===null||values===void 0?void 0:values.cost_total});if(!props.editData){_context.next=8;break;}_context.next=5;return props.updateComponentLogsAction(props.language,props.editData.id,requestData);case 5:response=_context.sent;_context.next=11;break;case 8:_context.next=10;return props.postComponentLogsAction(props.language,requestData);case 10:response=_context.sent;case 11:if(response.status===201||response.status===200){if(response.status===201){resetForm();toast.success(t(\"home:postSuccess\"));}else{setInitialData({component:null,log_type:null,maintenance_date:\"\",possible_failure:\"\",maintenance_action:\"\",duration:\"\",cost_total:0,labour_cost:0,material_cost:0,replacement_cost:0,remarks:\"\",is_cost_seggregated:false});toast.success(t(\"home:updateSuccess\"));}props.setEditData(null);props.toggle();props.getComponentLogsAction(props.language);}else{_errors=(_Object$values=Object.values(response.data))===null||_Object$values===void 0?void 0:_Object$values.map(function(item){toast.error(item[0]);});}case 12:case\"end\":return _context.stop();}}},_callee);}));function onSubmit(_x,_x2){return _onSubmit.apply(this,arguments);}return onSubmit;}()}),values=_useFormik.values,errors=_useFormik.errors,touched=_useFormik.touched,setFieldTouched=_useFormik.setFieldTouched,setFieldValue=_useFormik.setFieldValue,handleChange=_useFormik.handleChange,handleBlur=_useFormik.handleBlur,handleSubmit=_useFormik.handleSubmit;React.useEffect(function(){if(props.scheme){var _props$scheme;props.getDashboardComponentInfoAction(props.language,(_props$scheme=props.scheme)===null||_props$scheme===void 0?void 0:_props$scheme.slug);}},[props.scheme]);React.useEffect(function(){if(props.editData){var _props$editData,_props$editData2,_props$editData3,_props$editData4;var editData=_objectSpread(_objectSpread({},props.editData),{},{cost_total:((_props$editData=props.editData)===null||_props$editData===void 0?void 0:_props$editData.cost_total)||0,labour_cost:((_props$editData2=props.editData)===null||_props$editData2===void 0?void 0:_props$editData2.labour_cost)||0,material_cost:((_props$editData3=props.editData)===null||_props$editData3===void 0?void 0:_props$editData3.material_cost)||0,replacement_cost:((_props$editData4=props.editData)===null||_props$editData4===void 0?void 0:_props$editData4.replacement_cost)||0,component:{value:props.editData.component,label:props.editData.component_name}});delete editData.componant_picture;delete editData.supply_belt;setInitialData(editData);}},[props.editData]);return/*#__PURE__*/React.createElement(\"form\",{onSubmit:function onSubmit(e){e.preventDefault();handleSubmit(e);}},/*#__PURE__*/React.createElement(\"div\",{className:\"row rate_form align-items-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1 \"},t(\"maintainance:component\")),/*#__PURE__*/React.createElement(StyledSelect,{name:\"component\",options:props.componentInfoOptions||[],value:values.component,onChange:function onChange(_ref2){var name=_ref2.name,value=_ref2.value;setFieldValue(name,value);},onBlur:function onBlur(){setFieldTouched(\"component\",true);}}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"component\",errors:errors,touched:touched}))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1 \"},t(\"maintainance:logType\")),/*#__PURE__*/React.createElement(StyledSelect,{name:\"log_type\",options:LOG_TYPE_OPTIONS,value:(LOG_TYPE_OPTIONS===null||LOG_TYPE_OPTIONS===void 0?void 0:LOG_TYPE_OPTIONS.find(function(opt){return opt.label===(values===null||values===void 0?void 0:values.log_type);}))||null,onChange:function onChange(_ref3){var name=_ref3.name,value=_ref3.value;setFieldValue(name,value&&value[\"value\"]);},onBlur:function onBlur(){setFieldTouched(\"log_type\",true);}}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"log_type\",errors:errors,touched:touched}))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1 \"},t(\"home:maintainance\"),\" \",t(\"home:date\"),\" :\"),((_props$scheme2=props.scheme)===null||_props$scheme2===void 0?void 0:_props$scheme2.system_date_format)===\"nep\"?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(NepaliDatePicker,{value:values.maintenance_date,name:\"maintenance_date\",onChange:function onChange(e){setFieldValue(\"date\",e);}})):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(EnglishDatePicker,{name:\"maintenance_date\",value:values.maintenance_date,handleChange:function handleChange(e){setFieldValue(\"maintenance_date\",formatDate(e));}})),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"maintenance_date\",errors:errors,touched:touched}))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1 \"},t(\"finance:possibleFailure\"),\" :\"),/*#__PURE__*/React.createElement(\"input\",{className:\"form-control\",name:\"possible_failure\",value:values.possible_failure,onChange:handleChange,onBlur:handleBlur}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"possible_failure\",errors:errors,touched:touched}))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1 \"},t(\"home:maintainance\"),\" \",t(\"home:action\"),\" :\"),/*#__PURE__*/React.createElement(\"input\",{className:\"form-control\",name:\"maintenance_action\",value:values.maintenance_action,onChange:handleChange,onBlur:handleBlur}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"maintenance_action\",errors:errors,touched:touched}))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1 \"},t(\"home:duration\")),/*#__PURE__*/React.createElement(\"input\",{type:\"number\",className:\"form-control\",name:\"duration\",value:values.duration,onChange:handleChange,onBlur:handleBlur}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"duration\",errors:errors,touched:touched}))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-lg-12\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(CustomCheckBox,{id:\"is_cost_seggregated\",label:t(\"finance:icCostSegregated\"),checked:values.is_cost_seggregated,onChange:function onChange(e){return setFieldValue(\"is_cost_seggregated\",e.target.checked);}}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"is_cost_seggregated\",errors:errors,touched:touched}))),!values.is_cost_seggregated&&/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1 \"},t(\"home:total\"),\" \",t(\"home:cost\"),\":\"),/*#__PURE__*/React.createElement(\"input\",{type:\"number\",className:\"form-control\",name:\"cost_total\",value:values.cost_total,onChange:handleChange,onBlur:handleBlur}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"cost_total\",errors:errors,touched:touched}))),values.is_cost_seggregated&&/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1 \"},t(\"home:labor\"),\" \",t(\"home:cost\"),\" :\"),/*#__PURE__*/React.createElement(\"input\",{type:\"number\",className:\"form-control\",name:\"labour_cost\",value:values.labour_cost,onChange:handleChange,onBlur:handleBlur}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"labour_cost\",errors:errors,touched:touched}))),values.is_cost_seggregated&&/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1 \"},t(\"home:material\"),\" \",t(\"home:cost\"),\" :\"),/*#__PURE__*/React.createElement(\"input\",{type:\"number\",className:\"form-control\",name:\"material_cost\",value:values.material_cost,onChange:handleChange,onBlur:handleBlur}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"material_cost\",errors:errors,touched:touched}))),values.is_cost_seggregated&&/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1 \"},t(\"home:replacement\"),\" \",t(\"home:cost\"),\" :\"),/*#__PURE__*/React.createElement(\"input\",{type:\"number\",className:\"form-control\",name:\"replacement_cost\",value:values.replacement_cost,onChange:handleChange,onBlur:handleBlur}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"replacement_cost\",errors:errors,touched:touched}))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1 \"},t(\"finance:remarks\"),\" :\"),/*#__PURE__*/React.createElement(\"input\",{className:\"form-control\",name:\"remarks\",value:values.remarks,onChange:handleChange,onBlur:handleBlur}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"remarks\",errors:errors,touched:touched}))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-12 mt-2 text-right\"},/*#__PURE__*/React.createElement(Button,{className:\"btn custom-btn mr-2\",text:t(\"home:save\"),type:\"submit\",disabled:props.postLoading||props.updateLoading,loading:props.postLoading||props.updateLoading}),/*#__PURE__*/React.createElement(Button,{className:\"btn custom-btn-outlined mr-3\",text:t(\"home:cancel\"),onClick:function onClick(){return props.toggle();},type:\"button\"}))));};var mapStateToProps=function mapStateToProps(state){var _state$maintainanceDa;return{language:state.i18nextData.languageType,postLoading:state.componentLogs.postComponentLogs.isFetching,updateLoading:state.componentLogs.updateComponentLogs.isFetching,scheme:state.waterSchemeData.waterSchemeDetailsData.data,componentInfoOptions:(_state$maintainanceDa=state.maintainanceData.dashboardComponentInfoData.data)===null||_state$maintainanceDa===void 0?void 0:_state$maintainanceDa.map(function(item){var _item$component,_item$component2;return{label:item===null||item===void 0?void 0:(_item$component=item.component)===null||_item$component===void 0?void 0:_item$component.name,value:item===null||item===void 0?void 0:(_item$component2=item.component)===null||_item$component2===void 0?void 0:_item$component2.id};})};};var mapDispatchToProps={postComponentLogsAction:postComponentLogsAction,updateComponentLogsAction:updateComponentLogsAction,getComponentInfoAction:getComponentInfoAction,getSupplyBeltsAction:getSupplyBeltsAction,getComponentLogsAction:getComponentLogsAction,getDashboardComponentInfoAction:getDashboardComponentInfoAction};var connector=connect(mapStateToProps,mapDispatchToProps);export default connector(ComponentLists);","map":null,"metadata":{},"sourceType":"module"}