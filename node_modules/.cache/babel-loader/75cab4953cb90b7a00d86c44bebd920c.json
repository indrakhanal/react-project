{"ast":null,"code":"import _asyncToGenerator from\"C:/Users/S.K. COMPUTER/OneDrive/Desktop/react-project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"C:/Users/S.K. COMPUTER/OneDrive/Desktop/react-project/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/Users/S.K. COMPUTER/OneDrive/Desktop/react-project/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\S.K. COMPUTER\\\\OneDrive\\\\Desktop\\\\react-project\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import NepaliDatePicker from\"components/React/Datepicker/Datepicker\";import EnglishDatePicker from\"components/React/EnglishDatepicker/EnglishDatepicker\";import FormikValidationError from\"components/React/FormikValidationError/FormikValidationError\";import StyledSelect from\"components/React/StyledSelect/StyledSelect\";import toast from\"components/React/ToastNotifier/ToastNotifier\";import Button from\"components/UI/Forms/Buttons\";import{useFormik}from\"formik\";import React from\"react\";import{useTranslation}from\"react-i18next\";import{connect}from\"react-redux\";import{getExpenditureAction}from\"store/modules/expenditure/getExpenditure\";import{getExpenditureCategoryAction}from\"store/modules/expenditure/getExpenditureCategory\";import{getPreviousExpenditureTotalAction}from\"store/modules/expenditure/getPreviousExpenditureTotal\";import{postExpenseAction}from\"store/modules/expenditure/postExpense\";import{updateExpenditureAction}from\"store/modules/expenditure/updateExpense\";import{getIncomeCategoryAction}from\"store/modules/income/getIncomeCategory\";import formatDate,{getDefaultDate}from\"utils/utilsFunction/date-converter\";import*as Yup from\"yup\";var validationScheme=Yup.object({category:Yup.mixed().required(\"This field is required\"),date:Yup.string().required(\"This field is required\"),title:Yup.string().required(\"This field is required\"),income_amount:Yup.string().required(\"This field is required\"),remarks:Yup.string().required(\"This field is required\")});var initialFormData={category:null,date:\"\",title:\"\",income_amount:0,labour_cost:0,consumables_cost:0,replacement_cost:0,remarks:\"\",is_cost_seggregated:false};var ExpenseForm=function ExpenseForm(props){var _props$scheme3,_values$category2,_values$category3,_values$category4,_values$category5;var _useTranslation=useTranslation(),t=_useTranslation.t;var _React$useState=React.useState(initialFormData),_React$useState2=_slicedToArray(_React$useState,2),initialData=_React$useState2[0],setInitialData=_React$useState2[1];var _React$useState3=React.useState(),_React$useState4=_slicedToArray(_React$useState3,2),categoryOption=_React$useState4[0],setCategoryOptions=_React$useState4[1];React.useEffect(function(){if(props.schemeSlug){getIncomeCategoryAction(props.schemeSlug);}},[props.schemeSlug]);React.useEffect(function(){if(props.expenseCategories){var _props$expenseCategor;var options=(_props$expenseCategor=props.expenseCategories)===null||_props$expenseCategor===void 0?void 0:_props$expenseCategor.map(function(item){return{label:item.name,value:item.id,e_name:item.e_name};});setCategoryOptions(options);}},[props.expenseCategories]);React.useEffect(function(){if(props.activeDate){setInitialData(_objectSpread(_objectSpread({},initialData),{},{date:props.activeDate}));}},[props.activeDate]);React.useEffect(function(){if(props.editData){var _props$editData,_props$editData$categ,_props$editData2,_props$editData2$cate;setInitialData(_objectSpread(_objectSpread({},props.editData),{},{category:{label:(_props$editData=props.editData)===null||_props$editData===void 0?void 0:(_props$editData$categ=_props$editData.category)===null||_props$editData$categ===void 0?void 0:_props$editData$categ.name,value:(_props$editData2=props.editData)===null||_props$editData2===void 0?void 0:(_props$editData2$cate=_props$editData2.category)===null||_props$editData2$cate===void 0?void 0:_props$editData2$cate.id}}));}},[props.editData]);var _useFormik=useFormik({enableReinitialize:true,initialValues:initialData,validationSchema:validationScheme,onSubmit:function(){var _onSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(submitValue,_ref){var _submitValue$category,_values$category;var resetForm,requestData,res,_props$activeDate,_getDefaultDate,_props$scheme,_props$activeDate2,_getDefaultDate2,_props$scheme2,_Object$values,_errors;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:resetForm=_ref.resetForm;requestData=_objectSpread(_objectSpread({},submitValue),{},{category:submitValue===null||submitValue===void 0?void 0:(_submitValue$category=submitValue.category)===null||_submitValue$category===void 0?void 0:_submitValue$category.value});if((values===null||values===void 0?void 0:(_values$category=values.category)===null||_values$category===void 0?void 0:_values$category.e_name)===\"Maintenance\"&&values!==null&&values!==void 0&&values.is_cost_seggregated){requestData.income_amount=Number(values===null||values===void 0?void 0:values.consumables_cost)+Number(values===null||values===void 0?void 0:values.labour_cost)+Number(values===null||values===void 0?void 0:values.replacement_cost);}delete requestData.is_cost_seggregated;if(!props.editData){_context.next=10;break;}_context.next=7;return props.updateExpenditureAction(props.language,props.editData.id,requestData);case 7:res=_context.sent;_context.next=13;break;case 10:_context.next=12;return props.postExpenseAction(props.language,requestData);case 12:res=_context.sent;case 13:if(res.status===201||res.status===200){if(res.status===201){resetForm();toast.success(t(\"home:postSuccess\"));}else{setInitialData(initialFormData);toast.success(t(\"home:updateSuccess\"));}props.toggle(false);props.setEditData(null);props.getExpenditureAction(props.language,props.schemeSlug);props.getExpenditureCategoryAction(props.schemeSlug);props.getPreviousExpenditureTotalAction(props.language,props.schemeSlug,((_props$activeDate=props.activeDate)===null||_props$activeDate===void 0?void 0:_props$activeDate.split(\"-\")[0])||((_getDefaultDate=getDefaultDate((_props$scheme=props.scheme)===null||_props$scheme===void 0?void 0:_props$scheme.system_date_format))===null||_getDefaultDate===void 0?void 0:_getDefaultDate.split(\"-\")[0]),((_props$activeDate2=props.activeDate)===null||_props$activeDate2===void 0?void 0:_props$activeDate2.split(\"-\")[1])||((_getDefaultDate2=getDefaultDate((_props$scheme2=props.scheme)===null||_props$scheme2===void 0?void 0:_props$scheme2.system_date_format))===null||_getDefaultDate2===void 0?void 0:_getDefaultDate2.split(\"-\")[1]));}else{_errors=(_Object$values=Object.values(res.data))===null||_Object$values===void 0?void 0:_Object$values.map(function(item){toast.error(item[0]);});}case 14:case\"end\":return _context.stop();}}},_callee);}));function onSubmit(_x,_x2){return _onSubmit.apply(this,arguments);}return onSubmit;}()}),values=_useFormik.values,errors=_useFormik.errors,setFieldTouched=_useFormik.setFieldTouched,setFieldValue=_useFormik.setFieldValue,touched=_useFormik.touched,handleChange=_useFormik.handleChange,handleBlur=_useFormik.handleBlur,handleSubmit=_useFormik.handleSubmit;console.log(values,\"<<<<<\");return/*#__PURE__*/React.createElement(\"form\",{onSubmit:function onSubmit(e){e.preventDefault();handleSubmit(e);}},/*#__PURE__*/React.createElement(\"div\",{className:\"row align-items-end\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-12\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1\"},t(\"finance:category\"),\" :\"),/*#__PURE__*/React.createElement(StyledSelect,{name:\"category\",value:values.category,options:categoryOption,onChange:function onChange(_ref2){var name=_ref2.name,value=_ref2.value;setFieldValue(name,value);},onBlur:function onBlur(){setFieldTouched(\"category\",true);}}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"category\",errors:errors,touched:touched})))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-12\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1\"},t(\"finance:date\"),\" :\"),((_props$scheme3=props.scheme)===null||_props$scheme3===void 0?void 0:_props$scheme3.system_date_format)===\"nep\"?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(NepaliDatePicker,{value:values.date,name:\"date\",onChange:function onChange(e){setFieldValue(\"date\",e);}})):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(EnglishDatePicker,{name:\"date\",value:values.date,handleChange:function handleChange(e){setFieldValue(\"date\",formatDate(e));}})),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"date\",errors:errors,touched:touched})))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-12\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1\"},t(\"finance:title\"),\" :\"),/*#__PURE__*/React.createElement(\"input\",{className:\"form-control\",name:\"title\",value:values.title,onChange:handleChange,onBlur:handleBlur}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"title\",errors:errors,touched:touched})))),!(values!==null&&values!==void 0&&values.is_cost_seggregated)&&/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-12\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1\"},t(\"finance:amount\"),\" :\"),/*#__PURE__*/React.createElement(\"input\",{type:\"number\",className:\"form-control\",name:\"income_amount\",value:values.income_amount,onChange:handleChange,onBlur:handleBlur}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"income_amount\",errors:errors,touched:touched})))),(values===null||values===void 0?void 0:(_values$category2=values.category)===null||_values$category2===void 0?void 0:_values$category2.e_name)===\"Maintenance\"&&/*#__PURE__*/React.createElement(\"div\",{className:\"col-lg-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-check\"},/*#__PURE__*/React.createElement(\"input\",{className:\"form-check-input\",type:\"checkbox\",id:\"flexCheckChecked\",name:\"is_cost_seggregated\",checked:values.is_cost_seggregated,onChange:function onChange(e){setFieldValue(\"is_cost_seggregated\",e.target.checked);setFieldValue(\"income_amount\",0);}}),/*#__PURE__*/React.createElement(\"label\",{className:\"form-check-label\",htmlFor:\"flexCheckChecked\"},t(\"finance:icCostSegregated\"))),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"is_cost_seggregated\",errors:errors,touched:touched}))),(values===null||values===void 0?void 0:(_values$category3=values.category)===null||_values$category3===void 0?void 0:_values$category3.e_name)===\"Maintenance\"&&(values===null||values===void 0?void 0:values.is_cost_seggregated)&&/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-12\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1\"},t(\"home:labour\"),\" \",t(\"home:cost\"),\":\"),/*#__PURE__*/React.createElement(\"input\",{type:\"number\",className:\"form-control\",name:\"labour_cost\",value:values.labour_cost,onChange:handleChange,onBlur:handleBlur}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"labour_cost\",errors:errors,touched:touched})))),(values===null||values===void 0?void 0:(_values$category4=values.category)===null||_values$category4===void 0?void 0:_values$category4.e_name)===\"Maintenance\"&&(values===null||values===void 0?void 0:values.is_cost_seggregated)&&/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-12\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1\"},t(\"home:consumable\"),\" \",t(\"home:cost\"),\":\"),/*#__PURE__*/React.createElement(\"input\",{type:\"number\",className:\"form-control\",name:\"consumables_cost\",value:values.consumables_cost,onChange:handleChange,onBlur:handleBlur}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"consumables_cost\",errors:errors,touched:touched})))),(values===null||values===void 0?void 0:(_values$category5=values.category)===null||_values$category5===void 0?void 0:_values$category5.e_name)===\"Maintenance\"&&(values===null||values===void 0?void 0:values.is_cost_seggregated)&&/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-12\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1\"},t(\"home:replacement\"),\" \",t(\"home:cost\"),\":\"),/*#__PURE__*/React.createElement(\"input\",{type:\"number\",className:\"form-control\",name:\"replacement_cost\",value:values.replacement_cost,onChange:handleChange,onBlur:handleBlur}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"replacement_cost\",errors:errors,touched:touched})))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-12\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group \"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"\",className:\"mr-1\"},t(\"finance:remarks\"),\" :\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",className:\"form-control\",name:\"remarks\",value:values.remarks,onChange:handleChange,onBlur:handleBlur}),/*#__PURE__*/React.createElement(FormikValidationError,{name:\"remarks\",errors:errors,touched:touched})))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-12 text-right\"},/*#__PURE__*/React.createElement(Button,{className:\"btn custom-btn \",text:t(\"home:save\"),type:\"submit\",disabled:props.postLoading||props.updateLoading,loading:props.postLoading||props.updateLoading}))));};var mapStateToProps=function mapStateToProps(state){var _state$waterSchemeDat;return{language:state.i18nextData.languageType,schemeSlug:(_state$waterSchemeDat=state.waterSchemeData.waterSchemeDetailsData.data)===null||_state$waterSchemeDat===void 0?void 0:_state$waterSchemeDat.slug,scheme:state.waterSchemeData.waterSchemeDetailsData.data,expenseCategories:state.expenditureData.getExpenditureCategory.data,postLoading:state.expenditureData.postExpense.isFetching,updateLoading:state.expenditureData.updateExpense.isFetching};};var mapDispatchToProps={getExpenditureAction:getExpenditureAction,updateExpenditureAction:updateExpenditureAction,postExpenseAction:postExpenseAction,getExpenditureCategoryAction:getExpenditureCategoryAction,getPreviousExpenditureTotalAction:getPreviousExpenditureTotalAction};var connector=connect(mapStateToProps,mapDispatchToProps);export default connector(ExpenseForm);","map":null,"metadata":{},"sourceType":"module"}