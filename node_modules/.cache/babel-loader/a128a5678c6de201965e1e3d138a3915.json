{"ast":null,"code":"import _asyncToGenerator from\"C:/Users/S.K. COMPUTER/OneDrive/Desktop/react-project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/S.K. COMPUTER/OneDrive/Desktop/react-project/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\S.K. COMPUTER\\\\OneDrive\\\\Desktop\\\\react-project\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import{DeleteIcon,EditIconDark}from\"assets/images/xd\";import toast from\"components/React/ToastNotifier/ToastNotifier\";import ConfirmationModal from\"components/UI/ConfirmationModal\";import Button from\"components/UI/Forms/Buttons\";import GeneralModal from\"components/UI/GeneralModal\";import useDeleteConfirmation from\"hooks/useDeleteConfirmation\";import React,{useEffect,useState}from\"react\";import{useTranslation}from\"react-i18next\";import{connect}from\"react-redux\";import{deleteExpenditureAction}from\"store/modules/expenditure/deleteExpense\";import{getExpenditureAction}from\"store/modules/expenditure/getExpenditure\";import{getExpenditureCategoryAction}from\"store/modules/expenditure/getExpenditureCategory\";import{getPreviousExpenditureTotalAction}from\"store/modules/expenditure/getPreviousExpenditureTotal\";import{getDefaultDate}from\"utils/utilsFunction/date-converter\";import{sortAplabetically}from\"utils/utilsFunction/sorting\";import ExpenseForm from\"./ExpenseForm\";import ManageExpenditureCatagories from\"./ManageExpenditureCategories\";var CashbookExpenditureTable=function CashbookExpenditureTable(props){var _sortAplabetically,_sortAplabetically2,_sortAplabetically4;var _useState=useState(),_useState2=_slicedToArray(_useState,2),editData=_useState2[0],setEditData=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),categoriesModal=_useState4[0],setCategoriesModal=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),expenseModal=_useState6[0],setExpenseModal=_useState6[1];var toggle=function toggle(){return setCategoriesModal(!categoriesModal);};var toggleIncomeModal=function toggleIncomeModal(){setExpenseModal(!expenseModal);};var expenditureData=props.expenditureData,expenditureCategories=props.expenditureCategories,language=props.language,schemeSlug=props.schemeSlug,schemeDetails=props.schemeDetails,previousExpenditureTotal=props.previousExpenditureTotal,getExpenditureAction=props.getExpenditureAction,getExpenditureCategoryAction=props.getExpenditureCategoryAction,getPreviousExpenditureTotalAction=props.getPreviousExpenditureTotalAction;var _useDeleteConfirmatio=useDeleteConfirmation(),editId=_useDeleteConfirmatio.editId,modal=_useDeleteConfirmatio.modal,handleDeleteClick=_useDeleteConfirmatio.handleDeleteClick,resetDeleteData=_useDeleteConfirmatio.resetDeleteData,toggleModal=_useDeleteConfirmatio.toggleModal;// 2020 = 2020\n// props.activeDate?.split(\"-\")[1] =9\nuseEffect(function(){if(language&&schemeSlug&&schemeDetails&&props.activeTab){if(props.activeTab===\"2\"){var _props$activeDate,_getDefaultDate,_props$activeDate2,_getDefaultDate2,_props$activeDate3,_getDefaultDate3,_props$activeDate4,_getDefaultDate4;getExpenditureAction(language,schemeSlug,((_props$activeDate=props.activeDate)===null||_props$activeDate===void 0?void 0:_props$activeDate.split(\"-\")[0])||((_getDefaultDate=getDefaultDate(schemeDetails===null||schemeDetails===void 0?void 0:schemeDetails.system_date_format))===null||_getDefaultDate===void 0?void 0:_getDefaultDate.split(\"-\")[0]),((_props$activeDate2=props.activeDate)===null||_props$activeDate2===void 0?void 0:_props$activeDate2.split(\"-\")[1])||((_getDefaultDate2=getDefaultDate(schemeDetails===null||schemeDetails===void 0?void 0:schemeDetails.system_date_format))===null||_getDefaultDate2===void 0?void 0:_getDefaultDate2.split(\"-\")[1]));getExpenditureCategoryAction(schemeSlug);getPreviousExpenditureTotalAction(language,schemeSlug,((_props$activeDate3=props.activeDate)===null||_props$activeDate3===void 0?void 0:_props$activeDate3.split(\"-\")[0])||((_getDefaultDate3=getDefaultDate(schemeDetails===null||schemeDetails===void 0?void 0:schemeDetails.system_date_format))===null||_getDefaultDate3===void 0?void 0:_getDefaultDate3.split(\"-\")[0]),((_props$activeDate4=props.activeDate)===null||_props$activeDate4===void 0?void 0:_props$activeDate4.split(\"-\")[1])||((_getDefaultDate4=getDefaultDate(schemeDetails===null||schemeDetails===void 0?void 0:schemeDetails.system_date_format))===null||_getDefaultDate4===void 0?void 0:_getDefaultDate4.split(\"-\")[1]));}}},[language,props.activeDate,schemeSlug,schemeDetails,props.activeTab]);var _useTranslation=useTranslation(),t=_useTranslation.t;var handleDelete=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return props.deleteExpenditureAction(editId);case 3:response=_context.sent;if(response.status===204){toast.success(t(\"home:deleteSuccess\"));props.getExpenditureAction(props.language,props.schemeSlug);resetDeleteData();}else{toast.error(t(\"home:deleteError\"));resetDeleteData();}_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);console.log(_context.t0,\"error\");case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));return function handleDelete(){return _ref.apply(this,arguments);};}();var handleEdit=function handleEdit(data){setEditData(data);toggleIncomeModal();};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"mt-3\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row my-3\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-6 text-left\"},/*#__PURE__*/React.createElement(Button,{className:\"btn custom-btn  mr-3\",text:t(\"finance:addTxn\"),onClick:toggleIncomeModal})),/*#__PURE__*/React.createElement(\"div\",{className:\"col-6 text-right\"},/*#__PURE__*/React.createElement(Button,{className:\"btn custom-btn  mr-3\",text:t(\"finance:manageEC\")// disabled={authorizing}\n// loading={authorizing}\n,onClick:toggle}))),/*#__PURE__*/React.createElement(\"div\",{className:\"data-table table-responsive\"},/*#__PURE__*/React.createElement(\"table\",{className:\"table mt-2\"},/*#__PURE__*/React.createElement(\"thead\",null,/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"th\",null,t(\"cashbook:date\")),/*#__PURE__*/React.createElement(\"th\",null,t(\"cashbook:description\")),(_sortAplabetically=sortAplabetically(expenditureCategories,\"name\"))===null||_sortAplabetically===void 0?void 0:_sortAplabetically.map(function(category,index){return/*#__PURE__*/React.createElement(\"th\",{key:index},category.name);}),/*#__PURE__*/React.createElement(\"th\",{className:\"text-center\"},\"Action\"))),/*#__PURE__*/React.createElement(\"tbody\",null,/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null),/*#__PURE__*/React.createElement(\"td\",null,t(\"cashbook:from-prev-month\")),(_sortAplabetically2=sortAplabetically(expenditureCategories,\"name\"))===null||_sortAplabetically2===void 0?void 0:_sortAplabetically2.map(function(incomeCategory,index){var _previousExpenditureT;var findData=previousExpenditureTotal===null||previousExpenditureTotal===void 0?void 0:(_previousExpenditureT=previousExpenditureTotal.previous_month_data)===null||_previousExpenditureT===void 0?void 0:_previousExpenditureT.find(function(prev){return prev.expense_category_name===incomeCategory.name;});if(findData){var _props$schemeDetails;return/*#__PURE__*/React.createElement(\"td\",{key:index},(_props$schemeDetails=props.schemeDetails)===null||_props$schemeDetails===void 0?void 0:_props$schemeDetails.currency,\" \",findData.total_expense_amount);}else{return/*#__PURE__*/React.createElement(\"td\",{key:index},\"-\");}})),expenditureData===null||expenditureData===void 0?void 0:expenditureData.map(function(income,index){var _sortAplabetically3;return/*#__PURE__*/React.createElement(\"tr\",{key:index},/*#__PURE__*/React.createElement(\"td\",null,language===\"en\"?income.date:income.date_np),/*#__PURE__*/React.createElement(\"td\",null,income.title),(_sortAplabetically3=sortAplabetically(expenditureCategories,\"name\"))===null||_sortAplabetically3===void 0?void 0:_sortAplabetically3.map(function(incomeCategory,index){if(income.category.name===incomeCategory.name){var _props$schemeDetails2;return/*#__PURE__*/React.createElement(\"td\",{key:index},(_props$schemeDetails2=props.schemeDetails)===null||_props$schemeDetails2===void 0?void 0:_props$schemeDetails2.currency,\" \",income.income_amount);}else{return/*#__PURE__*/React.createElement(\"td\",{key:index},\"-\");}}),/*#__PURE__*/React.createElement(\"td\",{className:\"action\"},/*#__PURE__*/React.createElement(\"div\",{role:\"button\",onClick:function onClick(e){e.stopPropagation();handleEdit(income);}},/*#__PURE__*/React.createElement(\"img\",{src:EditIconDark,alt:\"\"})),/*#__PURE__*/React.createElement(\"div\",{role:\"button\",onClick:function onClick(e){e.stopPropagation();handleDeleteClick(income.id);}},/*#__PURE__*/React.createElement(\"img\",{src:DeleteIcon,alt:\"\"}))));}),/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null),/*#__PURE__*/React.createElement(\"td\",null,t(\"cashbook:total\")),(_sortAplabetically4=sortAplabetically(expenditureCategories,\"name\"))===null||_sortAplabetically4===void 0?void 0:_sortAplabetically4.map(function(incomeCategory,index){var _previousExpenditureT2;var findData=previousExpenditureTotal===null||previousExpenditureTotal===void 0?void 0:(_previousExpenditureT2=previousExpenditureTotal.present_month_data)===null||_previousExpenditureT2===void 0?void 0:_previousExpenditureT2.find(function(prev){return prev.expense_category_name===incomeCategory.name;});if(findData){var _props$schemeDetails3;return/*#__PURE__*/React.createElement(\"td\",{key:index},(_props$schemeDetails3=props.schemeDetails)===null||_props$schemeDetails3===void 0?void 0:_props$schemeDetails3.currency,\" \",findData.total_expense_amount);}else{return/*#__PURE__*/React.createElement(\"td\",{key:index},\"-\");}}),/*#__PURE__*/React.createElement(\"td\",null))))),/*#__PURE__*/React.createElement(GeneralModal,{title:t(\"finance:manageEC\"),open:categoriesModal,toggle:toggle,size:\"lg\"},/*#__PURE__*/React.createElement(ManageExpenditureCatagories,null)),/*#__PURE__*/React.createElement(GeneralModal,{title:t(\"home:addEdit\")+\" \"+t(\"home:expense\"),size:\"lg\",open:expenseModal,toggle:function toggle(){if(expenseModal){setEditData(null);}toggleIncomeModal();}},/*#__PURE__*/React.createElement(ExpenseForm,{editData:editData,setEditData:setEditData,toggle:setExpenseModal,activeDate:props.activeDate})),/*#__PURE__*/React.createElement(ConfirmationModal,{open:modal,handleModal:function handleModal(){return toggleModal();},handleConfirmClick:function handleConfirmClick(){return handleDelete();}})));};var mapStateToProps=function mapStateToProps(state){var _state$waterSchemeDat;return{language:state.i18nextData.languageType,sliderImages:state.incomeData.getIncomeExpenseImgae.data,schemeDetails:state.waterSchemeData.waterSchemeDetailsData.data,schemeSlug:(_state$waterSchemeDat=state.waterSchemeData.waterSchemeDetailsData.data)===null||_state$waterSchemeDat===void 0?void 0:_state$waterSchemeDat.slug,expenditureData:state.expenditureData.getExpenditureData.data,expenditureCategories:state.expenditureData.getExpenditureCategory.data,previousExpenditureTotal:state.expenditureData.getPreviousExpenditureTotal.data};};var mapDispatchToProps={getExpenditureAction:getExpenditureAction,deleteExpenditureAction:deleteExpenditureAction,getExpenditureCategoryAction:getExpenditureCategoryAction,getPreviousExpenditureTotalAction:getPreviousExpenditureTotalAction};var connector=connect(mapStateToProps,mapDispatchToProps);export default connector(CashbookExpenditureTable);","map":null,"metadata":{},"sourceType":"module"}